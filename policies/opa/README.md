# CloudSentinel OPA Quality Gate

This policy layer is the single ALLOW/DENY decision point for shift-left scans.

## Contract

- Input: `.cloudsentinel/golden_report.json` generated by `shift-left/normalizer/normalize.sh`
- Policy: `pipeline_decision.rego`
- Output query: `data.cloudsentinel.gate.decision`

## Decision Logic

- Deny if any scanner reports `NOT_RUN`
- Deny if `summary.global.CRITICAL` exceeds `quality_gate.thresholds.critical_max`
- Deny if `summary.global.HIGH` exceeds `quality_gate.thresholds.high_max`
- Allow only when no deny reason exists

## Local Validation

```bash
opa test policies/opa -v

opa eval \
  --input .cloudsentinel/golden_report.json \
  --data policies/opa/pipeline_decision.rego \
  "data.cloudsentinel.gate.decision"
```
