metadata:
  id: "CKV2_CS_AZ_022"
  name: "Ensure management ports (SSH/RDP) from Internet are restricted (CIS 6.3 & 6.4)"
  category: "NETWORKING"
  severity: "CRITICAL"
  guideline: "https://docs.microsoft.com/en-us/azure/security/fundamentals/network-best-practices"

definition:
  and:
    - cond_type: "attribute"
      resource_types:
        - "azurerm_network_security_rule"
      attribute: "destination_port_range"
      operator: "not_within"
      value: "22,3389"
    
    - cond_type: "attribute"
      resource_types:
        - "azurerm_network_security_rule"
      attribute: "source_address_prefix"
      operator: "not_equals"
      value: "*"
    
    - cond_type: "attribute"
      resource_types:
        - "azurerm_network_security_rule"
      attribute: "access"
      operator: "equals"
      value: "Deny"